<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workout Builder</title>

<style>
  :root {
    --brand:#2453f5;
    --ink:#0f172a;
    --sub:#64748b;
    --bg:#ffffff;
    --card:#f8f9fb;
    --pill-blue:#e8eeff;
    --pill-orange:#fff4e6;
    --pill-green:#e6fae9;
    --pill-blue-text:#2453f5;
    --pill-orange-text:#ff9f43;
    --pill-green-text:#22c55e;
  }

  body {
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro",Segoe UI,Roboto,sans-serif;
    margin:0;
    padding:0;
    background:var(--bg);
    color:var(--ink);
  }

  .container {
    padding:24px;
    max-width:480px;
    margin:auto;
  }

  .weather {
    font-size:15px;
    color:var(--sub);
    margin-bottom:14px;
  }

  h1 {
    font-size:28px;
    font-weight:700;
    margin:0 0 6px;
  }

  h2 {
    font-size:16px;
    font-weight:400;
    color:var(--sub);
    margin:0 0 18px;
  }

  /* RADIO ROW */
  .radio-row {
    display:flex;
    gap:18px;
    margin-bottom:22px;
  }

  .radio-option {
    display:flex;
    align-items:center;
    gap:6px;
    font-size:14px;
    cursor:pointer;
  }

  .radio-option input {
    appearance:none;
    width:18px;
    height:18px;
    border-radius:50%;
    border:2px solid #b7bfca;
    background:#fff;
    position:relative;
  }

  .radio-option input:checked {
    border-color:var(--brand);
  }
  .radio-option input:checked::after {
    content:"";
    position:absolute;
    inset:4px;
    border-radius:50%;
    background:var(--brand);
  }

  .radio-option.disabled {
    opacity:0.4;
    cursor:not-allowed;
  }

  .radio-option.active {
    font-weight:600;
    color:var(--brand);
  }

  /* AI STAGE GRADIENT */
  .ai-stage {
    height:160px;
    margin:12px 0 18px;
    display:none;
    border-radius:100%;
    position:relative;
  }
  .ai-stage::before {
    content:"";
    position:absolute;
    inset:-20% -15% -25% -15%;
    filter:blur(84px) saturate(160%) contrast(115%);
    opacity:0;
    transition:opacity .25s ease;
    background:
      radial-gradient(22rem 22rem at 30% 36%, #3A7BFF77 0, #0000 50%),
      radial-gradient(22rem 22rem at 72% 34%, #7DFF5C77 0, #0000 54%),
      radial-gradient(24rem 20rem at 40% 72%, #FFA43A77 0, #0000 54%),
      radial-gradient(20rem 20rem at 70% 74%, #9B8FFF99 0, #0000 80%);
    animation:meshBreath 2s ease-in-out infinite,
             meshDrift 3s ease-in-out infinite;
  }
  .ai-stage.show::before { opacity:.9; }

  @keyframes meshBreath {
    0%,100% { transform:scale(1); opacity:.7 }
    50%     { transform:scale(1.05); opacity:.3 }
  }
  @keyframes meshDrift {
    0% { transform:translate3d(0,0,0); }
    50% { transform:translate3d(2%,-1.5%,0); }
    100%{ transform:translate3d(0,0,0); }
  }

  /* WORKOUT CARD */
  .workout-card {
    background:var(--card);
    border-radius:16px;
    padding:20px;
    margin-top:8px;
  }

  .section-title {
    font-size:20px;
    font-weight:700;
    margin-bottom:10px;
  }

  .type-line {
    font-size:16px;
    margin-bottom:6px;
    display:flex;
    gap:8px;
    align-items:center;
  }

  /* Pills ------------------------------------------------ */
  .pill {
    padding:2px 8px;
    border-radius:10px;
    font-size:12px;
    font-weight:600;
  }

  .pill-weighted {
    background:var(--pill-blue);
    color:var(--pill-blue-text);
  }
  .pill-shoulders,
  .pill-biceps {
    background:var(--pill-orange);
    color:var(--pill-orange-text);
  }
  .pill-abs {
    background:var(--pill-green);
    color:var(--pill-green-text);
  }

  /* BUTTON */
  .create-btn {
    position:fixed;
    bottom:24px;
    left:50%;
    transform:translateX(-50%);
    width:calc(100% - 48px);
    max-width:480px;
    height:56px;
    background:var(--brand);
    color:#fff;
    border:none;
    border-radius:28px;
    font-size:18px;
    font-weight:600;
  }

  .create-btn:disabled { opacity:0.6; }

  .hidden { display:none !important; }
</style>
</head>
<body>

<div class="container">
  <div id="weather" class="weather">Enable location for weather</div>

  <h1>Welcome back Jy</h1>
  <h2 id="subtitle">What would you like to train?</h2>

  <div id="radioRow" class="radio-row">
    <label id="optPull" class="radio-option">
      <input type="radio" name="mode" value="pull"> Pull
    </label>
    <label id="optPush" class="radio-option">
      <input type="radio" name="mode" value="push"> Push
    </label>
    <label id="optLegs" class="radio-option">
      <input type="radio" name="mode" value="legs"> Legs
    </label>
    <label id="optFull" class="radio-option">
      <input type="radio" name="mode" value="full"> Full body
    </label>
  </div>

  <div id="aiStage" class="ai-stage"></div>

  <div id="output" style="display:none;">
    <div id="workoutCard" class="workout-card"></div>
  </div>
</div>

<button id="create" class="create-btn">Generate</button>

<script>
/* SHORTCUT */
const qs=s=>document.querySelector(s);
const DEV = new URLSearchParams(location.search).get("dev")==="true";

/* METALS */
const metals=["Metacon","EMOM","Ladder","AMRAP","Tabata"];

/* ABS pill logic */
const maybeAbs = ()=>Math.random()<0.5;

/* Weighted pill logic */
const maybeWeighted = ()=>Math.random()<0.25;

/* Helpers */
function pillWeighted(){ return `<span class="pill pill-weighted">Weighted</span>` }
function pillShoulders(){ return `<span class="pill pill-shoulders">Shoulders</span>` }
function pillBiceps(){ return `<span class="pill pill-biceps">Biceps</span>` }
function pillAbs(){ return `<span class="pill pill-abs">Abs</span>` }

/* Format pill order */
function assemblePills(weight, special, abs){
  let result="";
  if(weight) result+=pillWeighted()+" ";
  if(special) result+=special+" ";
  if(abs) result+=pillAbs();
  return result.trim();
}

/* Build metal label with optional Abs */
function metalLabel(){
  let base = metals[Math.floor(Math.random()*metals.length)];
  return base;
}

/* ===========================
      WORKOUT BUILDERS
=========================== */

/* ----- Push: Strength + 2 metals, max 1 shoulders ----- */
function buildPushHTML(){
  let h=`<div class="section-title">Push Day</div>`;

  h+=`<div class="type-line">Strength ${pillWeighted()}</div>`;

  let addShoulders=Math.random()<0.5;
  let shouldersSlot = addShoulders ? (Math.random()<0.5?1:2) : 0;

  for(let i=1;i<=2;i++){
    let label=metalLabel();
    let w=maybeWeighted();
    let a=maybeAbs();

    let sp = (i===shouldersSlot ? pillShoulders() : "");

    let pills = assemblePills(w,sp,a);

    h+=`<div class="type-line">${label} ${pills}</div>`;
  }
  return h;
}

/* ----- Pull: Strength + 2 metals, max 1 biceps ----- */
function buildPullHTML(){
  let h=`<div class="section-title">Pull Day</div>`;
  h+=`<div class="type-line">Strength ${pillWeighted()}</div>`;

  let addBiceps=Math.random()<0.5;
  let bicepsSlot = addBiceps ? (Math.random()<0.5?1:2) : 0;

  for(let i=1;i<=2;i++){
    let label=metalLabel();
    let w=maybeWeighted();
    let a=maybeAbs();

    let sp = (i===bicepsSlot ? pillBiceps() : "");
    let pills = assemblePills(w,sp,a);

    h+=`<div class="type-line">${label} ${pills}</div>`;
  }
  return h;
}

/* ----- Legs: 2–3 metals ----- */
function buildLegsHTML(){
  let h=`<div class="section-title">Legs Day</div>`;
  let count=Math.random()<0.5?2:3;

  for(let i=0;i<count;i++){
    let label=metalLabel();
    let w=maybeWeighted();
    let a=maybeAbs();
    let pills = assemblePills(w,"",a);
    h+=`<div class="type-line">${label} ${pills}</div>`;
  }
  return h;
}

/* ----- Full body: heavy pair OR metals ----- */
function buildFullHTML(){
  let h=`<div class="section-title">Full Body Day</div>`;
  let heavy=Math.random()<0.5;

  if(heavy){
    h+=`<div class="type-line">Push Strength ${pillWeighted()}</div>`;
    h+=`<div class="type-line">Pull Strength ${pillWeighted()}</div>`;

    let label=metalLabel();
    let w=maybeWeighted();
    let a=maybeAbs();
    let pills = assemblePills(w,"",a);

    h+=`<div class="type-line">${label} ${pills}</div>`;
  }else{
    for(let i=0;i<3;i++){
      let label=metalLabel();
      let w=maybeWeighted();
      let a=maybeAbs();
      let pills = assemblePills(w,"",a);
      h+=`<div class="type-line">${label} ${pills}</div>`;
    }
  }
  return h;
}

/* ============= UI STATE LOGIC (unchanged from your working version) ============= */

/* Just reusing your existing behavior — not rewriting it again */
function todayString(){
  const d=new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
}
function isAfter530(){
  if(DEV) return true;
  const n=new Date();
  const c=new Date();
  c.setHours(17,30,0,0);
  return n>=c;
}

/* Weekly locks */
function getWeekKey(){
  const d=new Date();
  const s=new Date(d.getFullYear(),0,1);
  const days=Math.floor((d-s)/86400000);
  const week=Math.ceil((d.getDay()+1+days)/7);
  return `${d.getFullYear()}-W${week}`;
}
function loadLocks(){ return JSON.parse(localStorage.getItem("locks")||"{}"); }
function saveLocks(x){ localStorage.setItem("locks",JSON.stringify(x)); }

(function resetWeekly(){
  const now=getWeekKey();
  const prev=localStorage.getItem("weekKey");
  if(now!==prev){
    localStorage.setItem("weekKey",now);
    localStorage.removeItem("locks");
    localStorage.removeItem("workoutToday");
  }
})();

/* Save today’s workout */
function saveToday(mode, html){
  if(DEV) return;
  localStorage.setItem("workoutToday",JSON.stringify({
    date:todayString(),
    mode,
    html
  }));
}
function loadToday(){
  if(DEV) return null;
  const raw=localStorage.getItem("workoutToday");
  if(!raw) return null;
  const obj=JSON.parse(raw);
  if(obj.date===todayString()) return obj;
  return null;
}

/* Radios and button */
const radioRow=qs("#radioRow");
const createBtn=qs("#create");
const subtitle=qs("#subtitle");
const output=qs("#output");
const card=qs("#workoutCard");
const aiStage=qs("#aiStage");
const radioMap={
  pull:qs("#optPull"),
  push:qs("#optPush"),
  legs:qs("#optLegs"),
  full:qs("#optFull")
};

function anyUnlocked(){
  if(DEV) return true;
  const locks=loadLocks();
  return Object.keys(radioMap).some(m=>!locks[m]);
}

function updateBtnText(){
  const sel=document.querySelector("input[name='mode']:checked");
  if(!sel){
    createBtn.textContent="Generate";
    return;
  }
  const m=sel.value;
  const label = (m==="full" ? "Full Body" : m.charAt(0).toUpperCase()+m.slice(1));
  createBtn.textContent=`Generate ${label}`;
}

function updateBtnState(){
  if(createBtn.style.display==="none") return;
  if(!isAfter530()){
    createBtn.disabled=true;
    createBtn.textContent="Available at 5:30 PM";
    return;
  }
  const sel=document.querySelector("input[name='mode']:checked");
  createBtn.disabled=!sel;
}

function refreshRadios(){
  const locks=DEV?{}:loadLocks();

  Object.entries(radioMap).forEach(([mode,lab])=>{
    const input=lab.querySelector("input");
    lab.classList.remove("active","disabled");

    input.disabled=false;
    if(locks[mode] && !DEV){
      input.disabled=true;
      lab.classList.add("disabled");
    }

    if(input.checked) lab.classList.add("active");
  });

  updateBtnText();
  updateBtnState();
}

/* Entry states */
function enterPre(){
  subtitle.textContent="What would you like to train?";
  radioRow.style.display="flex";
  output.style.display="none";
  createBtn.style.display = anyUnlocked()||DEV ? "block":"none";
  refreshRadios();
}

function enterPost(){
  subtitle.textContent="Today’s workout";
  radioRow.style.display="none";
  createBtn.style.display="none";
  output.style.display="block";
}

/* Generate button */
createBtn.addEventListener("click",()=>{
  const sel=document.querySelector("input[name='mode']:checked");
  if(!sel) return;
  let mode=sel.value;

  aiStage.style.display="block";
  aiStage.classList.add("show");
  output.style.display="none";
  createBtn.disabled=true;

  setTimeout(()=>{
    let html="";
    if(mode==="push") html=buildPushHTML();
    if(mode==="pull") html=buildPullHTML();
    if(mode==="legs") html=buildLegsHTML();
    if(mode==="full") html=buildFullHTML();

    card.innerHTML=html;

    aiStage.classList.remove("show");
    aiStage.style.display="none";

    if(!DEV){
      saveToday(mode,html);
      const locks=loadLocks();
      locks[mode]=true;
      saveLocks(locks);
    }

    enterPost();
  },900);
});

/* Init */
(function init(){
  const today=loadToday();
  if(today){
    card.innerHTML=today.html;
    enterPost();
  }else{
    enterPre();
  }
})();

document.querySelectorAll("input[name='mode']").forEach(r=>{
  r.addEventListener("change", refreshRadios);
});

/* Weather */
if(navigator.geolocation){
  navigator.geolocation.getCurrentPosition(async p=>{
    try{
      const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${p.coords.latitude}&longitude=${p.coords.longitude}&current_weather=true&timezone=auto`);
      const j=await r.json();
      qs("#weather").textContent=`${Math.round(j.current_weather.temperature)}°C`;
    }catch{ qs("#weather").textContent="Weather unavailable"; }
  },()=>qs("#weather").textContent="Enable location for weather");
}
</script>
</body>
</html>
