<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workout Builder</title>

<style>
  :root {
    --brand:#2453f5;
    --ink:#0f172a;
    --sub:#64748b;
    --bg:#ffffff;
    --card:#f8f9fb;
    --pill:#e8eeff;
    --disabled:#c0c7d1;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro", Segoe UI, Roboto, sans-serif;
    margin: 0;
    padding: 0;
    background: var(--bg);
    color: var(--ink);
  }

  .container {
    padding: 24px;
    max-width: 480px;
    margin: auto;
  }

  .weather {
    font-size: 15px;
    color: var(--sub);
    margin-bottom: 16px;
  }

  h1 {
    font-size: 28px;
    font-weight: 700;
    margin: 0 0 6px;
  }

  h2 {
    font-size: 17px;
    color: var(--sub);
    margin: 6px 0 20px;
  }

  /* Radio Button Row */
  .radio-row {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 20px;
  }

  .radio-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border: 1.8px solid #d0d7e2;
    border-radius: 20px;
    font-size: 16px;
    cursor: pointer;
    user-select: none;
    transition: 0.2s;
  }

  .radio-option input {
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    border: 2px solid #bcc7d6;
    position: relative;
  }

  .radio-option input:checked {
    border-color: var(--brand);
  }

  .radio-option input:checked::after {
    content:"";
    position:absolute;
    inset:4px;
    border-radius:50%;
    background: var(--brand);
  }

  .radio-option.active {
    border-color: var(--brand);
    background: #e8eeff;
    font-weight: 600;
  }

  /* Disabled locked state */
  .radio-option.disabled {
    opacity: 0.45;
    cursor: not-allowed;
  }

  /* AI gradient stage */
  .ai-stage {
    position: relative;
    height: 160px;
    margin: 10px 0 20px;
    display: none;
    border-radius: 100%;
    overflow: visible;
  }

  .ai-stage::before {
    content:"";
    position:absolute;
    inset:-20% -15% -25% -15%;
    opacity:0;
    filter:blur(84px) saturate(160%) contrast(115%);
    background:
      radial-gradient(22rem 22rem at 30% 36%, #3A7BFF77 0, #0000 50%),
      radial-gradient(22rem 22rem at 72% 34%, #7DFF5C77 0, #0000 54%),
      radial-gradient(24rem 20rem at 40% 72%, #FFA43A77 0, #0000 54%),
      radial-gradient(20rem 20rem at 70% 74%, #9B8FFF99 0, #0000 80%);
    background-blend-mode: screen;
    animation: meshBreath 2s infinite ease-in-out,
               meshDrift 3s infinite ease-in-out;
    transition: opacity .25s ease;
  }

  .ai-stage.show::before { opacity: 0.85; }

  @keyframes meshBreath {
    0%,100% { transform: scale(1); opacity:.7 }
    50% { transform: scale(1.05); opacity:.3 }
  }

  @keyframes meshDrift {
    0% { transform: translate3d(0,0,0); }
    50% { transform: translate3d(2%,-1.5%,0); }
    100% { transform: translate3d(0,0,0); }
  }

  /* Workout card */
  .workout-card {
    background: var(--card);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .section-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 6px;
  }

  .type-line {
    font-size: 16px;
    margin-bottom: 6px;
    display: flex;
    gap: 8px;
  }

  .pill {
    background: var(--pill);
    color: var(--brand);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
  }

  .create-btn {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 48px);
    max-width: 480px;
    height: 56px;
    background: var(--brand);
    color: white;
    border: none;
    border-radius: 28px;
    font-size: 18px;
    font-weight: 600;
  }

  .create-btn:disabled { opacity: 0.6; }
</style>
</head>
<body>

<div class="container">

  <div class="weather">Enable location for weather</div>

  <h1>Welcome back Jy</h1>
  <h2>What would you like to train?</h2>

  <div class="radio-row">
    <label class="radio-option" id="optPull">
      <input type="radio" name="mode" value="pull">
      Pull
    </label>

    <label class="radio-option" id="optPush">
      <input type="radio" name="mode" value="push">
      Push
    </label>

    <label class="radio-option" id="optLegs">
      <input type="radio" name="mode" value="legs">
      Legs
    </label>

    <label class="radio-option" id="optFull">
      <input type="radio" name="mode" value="full">
      Full Body
    </label>
  </div>

  <div id="aiStage" class="ai-stage"></div>

  <div id="output" style="display:none;">
    <div class="workout-card" id="workoutCard"></div>
  </div>

</div>

<button class="create-btn" id="create">Create Workout</button>

<script>
/* UTILITIES */
const qs = q => document.querySelector(q);
const all = q => document.querySelectorAll(q);

const metals = ["Metacon", "EMOM", "Ladder", "AMRAP", "Tabata"];

const radioOptions = {
  pull: qs("#optPull"),
  push: qs("#optPush"),
  legs: qs("#optLegs"),
  full: qs("#optFull")
};

const createBtn = qs("#create");
const output = qs("#output");
const aiStage = qs("#aiStage");
const workoutCard = qs("#workoutCard");

const DEV = new URLSearchParams(location.search).get("dev") === "true";

/* WEEKLY LOCK STORAGE */
function getWeekKey() {
  const d = new Date();
  const firstJan = new Date(d.getFullYear(), 0, 1);
  const week = Math.ceil(((d - firstJan) / 86400000 + firstJan.getDay()+1) / 7);
  return `week-${d.getFullYear()}-${week}`;
}

function loadLocks() {
  return JSON.parse(localStorage.getItem("locks") || "{}");
}

function saveLocks(locks) {
  localStorage.setItem("locks", JSON.stringify(locks));
}

function resetIfNewWeek() {
  const stored = localStorage.getItem("weekKey");
  const nowKey = getWeekKey();
  if (stored !== nowKey) {
    localStorage.setItem("weekKey", nowKey);
    saveLocks({});
  }
}

resetIfNewWeek();

/* RADIO UI LOGIC */
function refreshRadioStates() {
  const locks = loadLocks();

  for (let key in radioOptions) {
    const el = radioOptions[key];
    const input = el.querySelector("input");

    el.classList.remove("active", "disabled");
    input.disabled = false;

    if (locks[key] && !DEV) {
      input.checked = true;
      input.disabled = true;
      el.classList.add("disabled");
      continue;
    }

    if (input.checked) {
      el.classList.add("active");
    }
  }
}

all("input[name='mode']").forEach(r => {
  r.addEventListener("change", () => {
    refreshRadioStates();
  });
});

refreshRadioStates();

/* WORKOUT BUILDER */
function pick(arr) {
  return arr[Math.floor(Math.random()*arr.length)];
}

function maybeWeighted() {
  return Math.random() < 0.2;
}

function maybeAbs() {
  return Math.random() < 0.5;
}

function line(name) {
  let txt = name;
  if (maybeAbs()) txt += " + Abs";
  return txt;
}

function makeWorkout(mode) {
  let result = "";

  if (mode === "pull") {
    result += `<div class='section-title'>Pull Day</div>`;
    result += `<div class='type-line'>Pull Strength ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
    const m1 = pick(metals);
    const m2 = pick(metals);
    result += `<div class='type-line'>${line(m1)} ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
    result += `<div class='type-line'>${line(m2)} ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
  }

  if (mode === "push") {
    result += `<div class='section-title'>Push Day</div>`;
    result += `<div class='type-line'>Push Strength ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
    const m1 = pick(metals);
    const m2 = pick(metals);
    result += `<div class='type-line'>${line(m1)} ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
    result += `<div class='type-line'>${line(m2)} ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
  }

  if (mode === "legs") {
    result += `<div class='section-title'>Legs Day</div>`;
    const count = Math.random() < 0.5 ? 2 : 3;
    for (let i=0;i<count;i++) {
      const m = pick(metals);
      result += `<div class='type-line'>${line(m)} ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
    }
  }

  if (mode === "full") {
    result += `<div class='section-title'>Full Body Day</div>`;
    const heavy = Math.random() < 0.5;
    if (heavy) {
      result += `<div class='type-line'>Push Strength ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
      result += `<div class='type-line'>Pull Strength ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
    }
    const m = pick(metals);
    result += `<div class='type-line'>${line(m)} ${maybeWeighted() ? "<span class='pill'>Weighted</span>" : ""}</div>`;
  }

  workoutCard.innerHTML = result;
}

/* LOCK MODE FOR WEEK */
function lockMode(mode) {
  if (DEV) return;
  const locks = loadLocks();
  locks[mode] = true;
  saveLocks(locks);
}

/* BUTTON LOGIC */
createBtn.addEventListener("click", () => {
  let selected = qs("input[name='mode']:checked");
  if (!selected) return;
  const mode = selected.value;

  /* Animate */
  output.style.display = "none";
  aiStage.style.display = "block";
  aiStage.classList.add("show");
  createBtn.disabled = true;
  createBtn.textContent = DEV ? "Generating..." : "Generating...";

  setTimeout(() => {
    makeWorkout(mode);

    aiStage.classList.remove("show");
    aiStage.style.display = "none";
    output.style.display = "block";

    if (!DEV) lockMode(mode);

    refreshRadioStates();
    createBtn.disabled = false;
    createBtn.textContent = DEV ? "Create Workout (DEV)" : "Create Workout";
  }, 900);
});

/* WEATHER */
async function updateWeatherUI() {
  const el = qs(".weather");
  navigator.geolocation.getCurrentPosition(async pos => {
    try {
      const lat = pos.coords.latitude, lon = pos.coords.longitude;
      const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`);
      const j = await w.json();
      const temp = Math.round(j.current_weather.temperature);
      el.textContent = `${temp}Â°C`;
    } catch {
      el.textContent = "Weather unavailable";
    }
  }, () => el.textContent = "Enable location for weather");
}
updateWeatherUI();
</script>

</body>
</html>
