<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jy Workout</title>

  <!-- ðŸ”½ STEP 2: CSS GOES BETWEEN THESE TAGS -->
  <style>
   /* =========================================================
   RESET + TOKENS
========================================================= */
:root{
  --brand:#2453f5;
  --brand-soft:#e4ecff;
  --ink:#0f172a;
  --ink-soft:#475569;
  --muted:#94a3b8;

  --bg:#f8fafc;
  --card:#ffffff;

  --radius-xl:22px;
  --radius-lg:16px;
  --radius-md:12px;
  --radius-pill:999px;

  --shadow-xs:0 2px 6px rgba(15,23,42,.05);
  --shadow-sm:0 8px 20px rgba(15,23,42,.08);
  --shadow-md:0 18px 48px rgba(15,23,42,.12);

  --ease:cubic-bezier(.2,.8,.2,1);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro",Inter,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:var(--ink);
  -webkit-font-smoothing:antialiased;
  overflow:hidden;
}

/* =========================================================
   LAYOUT
========================================================= */
.container{
  max-width:520px;
  margin:0 auto;
  padding:18px 18px 0;
  height:100vh;
  display:flex;
  flex-direction:column;
}

.top-bar{
  display:flex;
  justify-content:flex-end;
  align-items:center;
  padding-bottom:8px;
}

.top-bar.hidden{ display:none; }

/* =========================================================
   HISTORY BUTTON
========================================================= */
.history-btn{
  background:none;
  border:none;
  font-size:14px;
  font-weight:600;
  color:var(--ink);
  cursor:pointer;
  opacity:.75;
  transition:opacity .2s var(--ease), transform .2s var(--ease);
}
.history-btn:hover{
  opacity:1;
  transform:translateY(-1px);
}
.history-btn.hidden{ display:none; }

/* =========================================================
   CENTER STAGE
========================================================= */
.center{
  position:relative;
  flex:1;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding-top:22px;
}

/* =========================================================
   WEEKLY COUNT (HERO)
========================================================= */
.weekly-center{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}
.weekly-center.hidden{ display:none; }

.weekly-count{
  text-align:center;
  transform:translateY(-12px);
}

.weekly-count .num{
  font-size:150px;
  font-weight:900;
  letter-spacing:-.06em;
  line-height:.9;
  color:rgba(15,23,42,.06);
}

.weekly-count .label{
  margin-top:10px;
  font-size:15px;
  font-weight:400;
  color:var(--muted);
  display:inline-flex;
  align-items:center;
  gap:8px;
}

.weekly-count .dot{ opacity:.5; }
.weekly-count .streak-inline{
  color:var(--ink);
  font-weight:500;
}

/* =========================================================
   WORKOUT CARD
========================================================= */
.card{
  width:100%;
  background:var(--card);
  border-radius:var(--radius-xl);
  box-shadow:var(--shadow-md);
  padding:22px;
  opacity:0;
  transform:translateY(18px) scale(.98);
  transition:all .35s var(--ease);
  z-index:3;
}

.card.visible{
  opacity:1;
  transform:translateY(0) scale(1);
}

.card.hidden{ display:none; }

.card-title{
  font-size:20px;
  font-weight:700;
  letter-spacing:-.03em;
  margin-bottom:16px;
}

/* =========================================================
   WORKOUT ROWS
========================================================= */
.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 0;
}

.row-text{
  font-size:16px;
  font-weight:400;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* =========================================================
   TAG PILLS
========================================================= */
.tags{
  display:flex;
  gap:8px;
}

.pill{
  padding:6px 12px;
  border-radius:var(--radius-pill);
  font-size:13px;
  font-weight:600;
  background:var(--brand-soft);
  color:var(--brand);
}

/* =========================================================
   ACTIONS
========================================================= */
.actions{
  position:relative;
  padding:14px 0 18px;
  transform:translateY(-1.5rem);
}

.btn{
  width:100%;
  height:52px;
  border:none;
  border-radius:var(--radius-pill);
  font-size:17px;
  font-weight:600;
  cursor:pointer;
  background:var(--brand);
  color:#fff;
  box-shadow:var(--shadow-sm);
  transition:transform .15s var(--ease), box-shadow .15s var(--ease);
}

.btn:hover{
  transform:translateY(-1px);
  box-shadow:var(--shadow-md);
}

.btn.secondary{
  margin-top:12px;
  background:#eef2f7;
  color:var(--brand);
  box-shadow:none;
}

.btn.hidden{ display:none; }

/* =========================================================
   TIMER BUTTON (TEXT-ONLY)
========================================================= */
#startTimerBtn{
  background:none;
  box-shadow:none;
  color:var(--brand);
  font-weight:600;
}

/* =========================================================
   SLIDER
========================================================= */
.slide-wrap{
  margin-top:16px;
  height:52px;
  background:#eef2f7;
  border-radius:var(--radius-pill);
  position:relative;
  overflow:hidden;
  display:none;
}

.slide-wrap.show{ display:block; }

.slide-fill{
  position:absolute;
  inset:0;
  width:0%;
  background:linear-gradient(135deg,#2453f5,#4f8cff);
}

.slide-label{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:600;
}

.slide-label .base{ color:var(--brand); }

.slide-label .white{
  position:absolute;
  inset:0;
  color:#fff;
  clip-path:inset(0 100% 0 0);
}

.slide-knob{
  position:absolute;
  left:7px;
  top:50%;
  transform:translateY(-50%);
  width:42px;
  height:42px;
  border-radius:50%;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:var(--shadow-sm);
}

/* =========================================================
   MODALS (APPLE-LIKE)
========================================================= */
.modal{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.4);
  display:none;
  z-index:50;
  backdrop-filter:blur(6px);
}

.modal.show{ display:block; }

.modal-sheet{
  position:absolute;
  inset:0;
  background:#fff;
  display:flex;
  flex-direction:column;
}

.modal-head{
  padding:16px 18px;
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid rgba(15,23,42,.06);
}

.modal-title{
  font-size:20px;
  font-weight:800;
}

.modal-close{
  border:none;
  background:#eef2f7;
  border-radius:10px;
  padding:8px 14px;
  font-weight:700;
  cursor:pointer;
}

.modal-body{
  padding:18px;
  overflow:auto;
  flex:1;
}

/* =========================================================
   HISTORY LIST
========================================================= */
.history-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  border-radius:var(--radius-md);
  background:#f8fafc;
}

.history-time{
  font-size:16px;
  font-weight:700;
}

.history-date{
  font-size:12px;
  color:var(--muted);
}

.pr-badge{
  font-size:11px;
  font-weight:700;
  background:#dcfce7;
  color:#16a34a;
  padding:4px 8px;
  border-radius:var(--radius-pill);
}
  </style>
</head>

<body>

  <!-- ðŸ”½ ALL YOUR HTML MARKUP GOES HERE -->
  <!-- modals, container, buttons, cards, etc -->

  <!-- ðŸ”½ STEP 3: JS GOES BETWEEN THESE TAGS -->
  <script>
    /* =========================================================
   STORAGE KEYS
========================================================= */
const LS = {
  library: "jy_library_v1",
  streak: "jy_streak_v1",
  weekKey: "jy_weekKey_v1",
  weekCount: "jy_weekCount_v1",
  weekCounted: "jy_week_counted_v1",
  totalDays: "jy_total_days_trained_v1",
  lastDone: "jy_last_workout_date_v1",
  metaconHistory: "jy_metacon_history_v1",
  currentWorkout: "jy_current_workout_v1",
  timerState: "jy_metacon_timer_v1",
};

/* =========================================================
   UTIL
========================================================= */
const qs = s => document.querySelector(s);
const rand = arr => arr[Math.floor(Math.random() * arr.length)];

function loadJSON(key, fallback) {
  try {
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : fallback;
  } catch {
    return fallback;
  }
}
function saveJSON(key, val) {
  localStorage.setItem(key, JSON.stringify(val));
}

function todayKey() {
  const d = new Date();
  return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}

function isoWeekKey(d = new Date()) {
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  const dayNum = date.getUTCDay() || 7;
  date.setUTCDate(date.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
  const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
  return `${date.getUTCFullYear()}-W${weekNo}`;
}

function formatTime(ms) {
  const t = Math.floor(ms / 1000);
  const m = String(Math.floor(t / 60)).padStart(2, "0");
  const s = String(t % 60).padStart(2, "0");
  return `${m}:${s}`;
}

function formatDate(d) {
  return new Date(d).toLocaleDateString(undefined, {
    day: "numeric",
    month: "short",
    year: "numeric",
  });
}

/* =========================================================
   DOM
========================================================= */
const generateBtn = qs("#generateBtn");
const exerciseBtn = qs("#exerciseBtn");
const startTimerBtn = qs("#startTimerBtn");
const slideWrap = qs("#slideWrap");
const slideFill = qs("#slideFill");
const slideKnob = qs("#slideKnob");
const slideWhite = qs("#slideWhite");

const card = qs("#card");
const cardTitle = qs("#cardTitle");
const cardRows = qs("#cardRows");

const weeklyCenter = qs("#weeklyCenter");
const weekNumEl = qs("#weekNum");
const streakInline = qs("#streakInline");

const historyBtn = qs("#historyBtn");
const historyModal = qs("#historyModal");
const closeHistoryModal = qs("#closeHistoryModal");
const historyList = qs("#historyList");

const confettiCanvas = qs("#confettiCanvas");
const confettiFx = window.confetti
  ? window.confetti.create(confettiCanvas, { resize: true, useWorker: true })
  : null;

/* =========================================================
   DATA
========================================================= */
const TAGS = ["upper","pull","push","shoulders","legs","abs","fullbody","cardio"];

const DEFAULT_LIBRARY = {
  upper:[{name:"Muscle-Ups",reps:"5"}],
  pull:[{name:"Pull-Ups",reps:"10"}],
  push:[{name:"Push-Ups",reps:"20"}],
  shoulders:[{name:"Pike Push-Ups",reps:"15"}],
  legs:[{name:"Jump Squats",reps:"25"}],
  abs:[{name:"Crunches",reps:"40"}],
  fullbody:[{name:"Burpees",reps:"15"}],
  cardio:[{name:"Jumping Jacks",reps:"50"}],
};

let library = loadJSON(LS.library, structuredClone(DEFAULT_LIBRARY));
saveJSON(LS.library, library);

let currentWorkout = loadJSON(LS.currentWorkout, null);
let timerInterval = null;
let timerStart = null;

/* =========================================================
   STREAK + COUNTS
========================================================= */
function getStreak() {
  return parseInt(localStorage.getItem(LS.streak) || "0", 10);
}
function setStreak(n) {
  localStorage.setItem(LS.streak, String(n));
}
function getTotalDays() {
  return parseInt(localStorage.getItem(LS.totalDays) || "0", 10);
}
function setTotalDays(n) {
  localStorage.setItem(LS.totalDays, String(n));
}

function ensureWeek() {
  const wk = isoWeekKey();
  if (localStorage.getItem(LS.weekKey) !== wk) {
    localStorage.setItem(LS.weekKey, wk);
    localStorage.setItem(LS.weekCount, "0");
    localStorage.setItem(LS.weekCounted, "0");
  }
}

/* =========================================================
   WORKOUT GENERATION
========================================================= */
function generateAMRAP() {
  const pool = TAGS.filter(() => Math.random() < 0.6);
  const picked = pool.length >= 3 ? pool.slice(0, 4) : TAGS.slice(0, 3);

  return {
    type: "As Many Rounds As Possible",
    rows: picked.map(tag => {
      const ex = rand(library[tag]);
      return { text: `${ex.reps} ${ex.name}`, tag };
    })
  };
}

function generateMetacon() {
  return {
    type: "Metabolic Conditioning",
    rows: [
      "50 Pull-Ups",
      "50 Dips",
      "100 Jump Squats",
      "50 Pike Push-Ups",
      "100 Crunches",
      "50 Burpees",
    ].map(t => ({ text: t }))
  };
}

/* =========================================================
   RENDER
========================================================= */
function renderWorkout(w) {
  cardTitle.textContent = w.type;
  cardRows.innerHTML = "";
  w.rows.forEach(r => {
    const div = document.createElement("div");
    div.className = "row";
    div.innerHTML = `<div class="row-text">${r.text}</div>`;
    cardRows.appendChild(div);
  });
  card.classList.remove("hidden");
  requestAnimationFrame(() => card.classList.add("visible"));
}

/* =========================================================
   TIMER
========================================================= */
startTimerBtn.addEventListener("click", () => {
  if (timerInterval) return;

  timerStart = Date.now();
  saveJSON(LS.timerState, { start: timerStart });

  startTimerBtn.textContent = "00:00";

  timerInterval = setInterval(() => {
    startTimerBtn.textContent = formatTime(Date.now() - timerStart);
  }, 500);
});

/* =========================================================
   SLIDER
========================================================= */
let sliding = false;
let startX = 0;

slideKnob.addEventListener("pointerdown", e => {
  sliding = true;
  startX = e.clientX;
});

slideKnob.addEventListener("pointermove", e => {
  if (!sliding) return;
  const dx = Math.max(0, e.clientX - startX);
  slideFill.style.width = `${Math.min(dx / 3, 100)}%`;
  slideWhite.style.clipPath = `inset(0 ${100 - dx / 3}% 0 0)`;
});

slideKnob.addEventListener("pointerup", () => {
  sliding = false;
  if (parseInt(slideFill.style.width) > 85) {
    completeWorkout();
  } else {
    slideFill.style.width = "0%";
    slideWhite.style.clipPath = "inset(0 100% 0 0)";
  }
});

/* =========================================================
   COMPLETE WORKOUT
========================================================= */
function completeWorkout() {
  localStorage.removeItem(LS.currentWorkout);
  if (timerInterval) clearInterval(timerInterval);

  if (confettiFx) {
    confettiFx({ particleCount: 180, spread: 90, startVelocity: 40 });
  }

  setTotalDays(getTotalDays() + 1);
  streakInline.textContent = `${getStreak()} week streak`;
  weekNumEl.textContent = getTotalDays();

  card.classList.add("hidden");
  weeklyCenter.classList.remove("hidden");
}

/* =========================================================
   HISTORY
========================================================= */
historyBtn.addEventListener("click", () => {
  const hist = loadJSON(LS.metaconHistory, []);
  historyList.innerHTML = hist.length
    ? hist.map(h =>
        `<div class="history-row">
           <div>
             <div class="history-time">${formatTime(h.time)}</div>
             <div class="history-date">${formatDate(h.date)}</div>
           </div>
         </div>`
      ).join("")
    : "<div>No history yet</div>";
  historyModal.classList.add("show");
});

closeHistoryModal.addEventListener("click", () => {
  historyModal.classList.remove("show");
});

/* =========================================================
   INIT
========================================================= */
function init() {
  ensureWeek();
  weekNumEl.textContent = getTotalDays();
  streakInline.textContent = `${getStreak()} week streak`;

  if (currentWorkout) {
    renderWorkout(currentWorkout);
    weeklyCenter.classList.add("hidden");
  }
}

init();
  </script>

</body>
</html>
